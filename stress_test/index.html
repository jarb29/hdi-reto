<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Load Testing - HDI Challenge Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../assets/_mkdocstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Load Testing";
        var mkdocs_page_input_path = "stress_test.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> HDI Challenge Documentation
        </a>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../quickstart/">Quick Start Guide</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../initialization/">Initialization Guide</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../configuration/">Project Configuration</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../api/">API Reference</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../commands/">Command Line Interface</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../deploy/">Standard Deployment Guide</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">Load Testing</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#tool">Tool</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#test-scenarios">Test Scenarios</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#locust-file-teststresslocustfilepy">Locust File (test/stress/locustfile.py)</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#running-stress-tests">Running Stress Tests</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#results-and-analysis">Results and Analysis</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#example-results">Example Results</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../unit_test/">Unit Testing</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../coverage/">Coverage Test</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../bandit/">Security Analysis</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../licence/">License Agreement</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">HDI Challenge Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Load Testing</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="stress-tests">Stress Tests</h1>
<p>This document provides details on the stress testing strategy for the HDI Claims Prediction API, evaluating its performance and stability under high load.</p>
<hr />
<h2 id="tool">Tool</h2>
<p>We use <strong>Locust</strong> for stress testing. Locust is an open-source load testing tool that simulates many concurrent users by defining user behavior.</p>
<hr />
<h2 id="test-scenarios">Test Scenarios</h2>
<p>Stress test scenarios are defined in <code>tests/stress/locustfile.py</code>. This script simulates user behavior, such as sending requests to the <code>/api/v1/predict/</code> endpoint.</p>
<h3 id="locust-file-teststresslocustfilepy">Locust File (<code>test/stress/locustfile.py</code>)</h3>
<pre><code class="language-python">from locust import HttpUser, TaskSet, task, between
import logging
from random import randint
import time

class PredictTaskSet(TaskSet):

    def on_start(self):
        &quot;&quot;&quot; This method is called when a simulated user starts &quot;&quot;&quot;
        logging.info(&quot;Starting a new simulated user session.&quot;)

    @task
    def predict(self):
        payload = {
            &quot;claim_id&quot;: randint(1, 100),
            &quot;marca_vehiculo&quot;: &quot;ford&quot;,
            &quot;antiguedad_vehiculo&quot;: randint(1, 10),
            &quot;tipo_poliza&quot;: randint(1, 3),
            &quot;taller&quot;: randint(1, 2),
            &quot;partes_a_reparar&quot;: randint(1, 5),
            &quot;partes_a_reemplazar&quot;: randint(0, 3)
        }

        start_time = time.time()
        response = self.client.post(&quot;/api/v1/predict/&quot;, json=payload)
        end_time = time.time()

        response_time = end_time - start_time

        if response.status_code != 200:
            logging.error(f&quot;Error: {response.status_code}, Response: {response.text}&quot;)
        else:
            logging.info(f&quot;Response time: {response_time:.2f} seconds&quot;)

        assert response.status_code == 200, f&quot;Error: {response.status_code}&quot;

    def on_stop(self):
        &quot;&quot;&quot; This method is called when a simulated user stops &quot;&quot;&quot;
        logging.info(&quot;Stopping the simulated user session.&quot;)

class PredictTestUser(HttpUser):
    tasks = [PredictTaskSet]
    wait_time = between(1, 5)
    host = &quot;http://127.0.0.1:8000&quot;  # Adjust host as necessary
</code></pre>
<hr />
<h2 id="running-stress-tests">Running Stress Tests</h2>
<ol>
<li><strong>Start the API Server</strong></li>
<li>
<p>Ensure the API server is running (e.g., <code>make run</code>).</p>
</li>
<li>
<p><strong>Execute Locust</strong>
    <code>bash
    make stress-tests</code></p>
</li>
<li>
<p>This starts Locust and opens a web interface at <a href="http://127.0.0.1:8089">http://127.0.0.1:8089</a>.</p>
</li>
<li>
<p><strong>Configure and Run</strong></p>
</li>
<li>In the Locust UI, set the number of users and hatch rate. Start the test to simulate traffic.</li>
</ol>
<hr />
<h2 id="results-and-analysis">Results and Analysis</h2>
<p>Locust provides charts and reports on the requests per second (RPS), response times, and failures. Analyze these results to identify bottlenecks under high load.</p>
<h3 id="example-results">Example Results</h3>
<p>Example results are detailed below. These are located in <code>tests/stress/results/results.md</code>.</p>
<h1 id="stress-test-results-analysis">Stress Test Results Analysis</h1>
<h2 id="requests-per-second-rps">Requests per Second (RPS)</h2>
<ul>
<li>The "Total Requests per Second" chart shows a request rate of around 0.6 RPS. This suggests that the system is continuously managing requests, although the rate isn't very high.</li>
<li>For a stress test, this could indicate slow request processing speeds, possibly due to the workload or the capacity of the model running on the endpoint.</li>
</ul>
<p><img alt="Total Requests per Second" src="../images/C1.png" /></p>
<h2 id="response-times">Response Times</h2>
<ul>
<li>The "Response Times" chart shows high response times, with an average of around 12064 ms and a similar median, indicating most requests take over 12 seconds to process.</li>
<li>The minimum recorded time is 12064 ms, while the maximum reaches 12369 ms. This suggests consistent latency, possibly due to heavy models and processing pipelines taking considerable time to complete.</li>
<li>High latency could be an area for improvement since lower response times are preferable in production applications to provide an adequate user experience.</li>
</ul>
<p><img alt="Response Times" src="../images/C2.png" /></p>
<h2 id="concurrent-users">Concurrent Users</h2>
<ul>
<li>In the "Number of Users" chart, the number of users remains steady at 10. This was the peak number of concurrent users configured during the test, and the system was able to handle this load without response errors (failures).</li>
<li>The fact that the system can support 10 users without failures is positive, but the high latency indicates it might not scale well with a much larger number of concurrent users.</li>
</ul>
<h2 id="tabular-summary">Tabular Summary</h2>
<ul>
<li>In the results table, we observe that a total of 117 requests were made, and none failed. This is positive and shows that the endpoint is robust in handling requests without errors.</li>
<li>The average response size is 32 bytes, which is low, suggesting that the response probably only contains the prediction result and no additional data.</li>
</ul>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../deploy/" class="btn btn-neutral float-left" title="Standard Deployment Guide"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../unit_test/" class="btn btn-neutral float-right" title="Unit Testing">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../deploy/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../unit_test/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
